"use strict";(self.webpackChunkamazon_connect_project=self.webpackChunkamazon_connect_project||[]).push([[122],{549:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AppContext=void 0;const r=n(1404);class o extends r.Context{constructor(e,t,n,r){super(e),this.appInstanceId=t,this.appConfig=n,this.contactScope=r}}t.AppContext=o},551:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.VoiceRoutes=void 0,function(e){e.getPhoneNumber="contact/getPhoneNumber",e.getInitialCustomerPhoneNumber="voice/getInitialCustomerPhoneNumber",e.listDialableCountries="voice/listDialableCountries",e.createOutboundCall="voice/createOutboundCall",e.getOutboundCallPermission="voice/getOutboundCallPermission"}(n||(t.VoiceRoutes=n={}))},1393:(e,t)=>{var n,r;Object.defineProperty(t,"__esModule",{value:!0}),t.AgentTopicKey=t.ContactLifecycleTopicKey=void 0,function(e){e.StartingACW="contact/acw",e.Connected="contact/connected",e.Destroyed="contact/destroy",e.Missed="contact/missed",e.Cleared="contact/cleared"}(n||(t.ContactLifecycleTopicKey=n={})),function(e){e.StateChanged="agent/stateChange"}(r||(t.AgentTopicKey=r={}))},1404:(e,t,n)=>{let r;function o(e){r=e}function s(e){if(!r)throw new Error(null!=e?e:"Attempted to get Global AmazonConnectProvider that has not been set.");return r}n.r(t),n.d(t,{AmazonConnectProviderBase:()=>F,AsyncEventEmitter:()=>u,ConnectClient:()=>$,ConnectError:()=>i,ConnectLogger:()=>Q,ConnectMetricRecorder:()=>M,Context:()=>W,DurationMetricRecorder:()=>x,Emitter:()=>d,EventEmitter:()=>h,LogLevel:()=>B,ModuleContext:()=>G,Proxy:()=>N,RequestManager:()=>T,SubscriptionHandlerRelay:()=>q,SubscriptionMap:()=>f,SubscriptionSet:()=>C,TimeoutTracker:()=>z,createLogMessage:()=>V,createMetricMessage:()=>I,createModuleProxy:()=>y,createRequestMessage:()=>j,formatClientTimeoutError:()=>k,generateStringId:()=>p,generateUUID:()=>g,getGlobalProvider:()=>s,getOriginAndPath:()=>m,handlerNotFoundResponseErrorKey:()=>P,isClientTimeoutResponseError:()=>S,isConnectError:()=>a,isNoResultResponseError:()=>A,logToConsole:()=>K,noResultResponseErrorKey:()=>O,resetGlobalProvider:()=>o,sdkVersion:()=>J});class i extends Error{constructor({reason:e,namespace:t,errorKey:n,details:r}){super(`ConnectError with error key "${n}"`),this.errorType=i.ErrorType,this.namespace=t,this.errorKey=n,this.reason=e,this.details=null!=r?r:{}}}function a(e){return Boolean(e instanceof i||e&&"object"==typeof e&&"errorType"in e&&e.errorType===i.ErrorType)}i.ErrorType="ConnectError";class c{constructor({provider:e,loggerKey:t}){this.events=new Map,this.logger=new Q({provider:e,source:"emitter",mixin:()=>({emitterLoggerKey:t})})}on(e,t){const n=this.events.get(e);n?n.add(t):this.events.set(e,new Set([t]))}off(e,t){const n=this.events.get(e);n&&(n.delete(t),n.size<1&&this.events.delete(e))}getHandlers(e){var t;return Array.from(null!==(t=this.events.get(e))&&void 0!==t?t:[])}}var l=function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}c((r=r.apply(e,t||[])).next())}))};class u extends c{emit(e,t){return l(this,void 0,void 0,(function*(){const n=this.getHandlers(e);yield Promise.allSettled(n.map((n=>l(this,void 0,void 0,(function*(){try{yield n(t)}catch(t){this.logger.error("An error occurred when invoking event handler",{error:t,parameter:e})}})))))}))}}class d extends c{emit(e){for(const t of this.getHandlers(e))try{t()}catch(t){this.logger.error("An error occurred when invoking handler",{error:t,parameter:e})}}}class h extends c{emit(e,t){const n=this.getHandlers(e);for(const r of n)try{r(t)}catch(t){this.logger.error("An error occurred when invoking event handler",{error:t,parameter:e})}}}function p(e){const t=new Uint8Array(Math.ceil(e/2));return crypto.getRandomValues(t),Array.from(t,(e=>e.toString(16).padStart(2,"0"))).join("").substring(0,e)}function g(){return"randomUUID"in crypto?crypto.randomUUID():"10000000-1000-4000-8000-100000000000".replace(/[018]/g,(e=>{const t=parseInt(e);return(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16)}))}function m(){var e,t,n,r;return{origin:null!==(t=null===(e=null===document||void 0===document?void 0:document.location)||void 0===e?void 0:e.origin)&&void 0!==t?t:"unknown",path:null!==(r=null===(n=null===document||void 0===document?void 0:document.location)||void 0===n?void 0:n.pathname)&&void 0!==r?r:"unknown"}}function y(e,t){return{request:(n,r)=>e.request(t,n,r),subscribe:(n,r)=>e.subscribe(Object.assign(Object.assign({},n),{namespace:t}),r),unsubscribe:(n,r)=>e.unsubscribe(Object.assign(Object.assign({},n),{namespace:t}),r),getProxyInfo:()=>({connectionStatus:e.connectionStatus,proxyType:e.proxyType}),onConnectionStatusChange:t=>e.onConnectionStatusChange(t),offConnectionStatusChange:t=>e.offConnectionStatusChange(t)}}class v{constructor(){this.idsByHandler=new Map,this.handlersById=new Map}add(e){const t=this.idsByHandler.get(e);if(t)return{handlerId:t};const n=g();return this.idsByHandler.set(e,n),this.handlersById.set(n,e),{handlerId:n}}getIdByHandler(e){var t;return null!==(t=this.idsByHandler.get(e))&&void 0!==t?t:null}getHandlerById(e){var t;return null!==(t=this.handlersById.get(e))&&void 0!==t?t:null}get(){return[...this.idsByHandler.entries()].map((([e,t])=>({handler:e,handlerId:t})))}delete(e){const t=this.idsByHandler.get(e);return t&&this.handlersById.delete(t),this.idsByHandler.delete(e),{isEmpty:this.idsByHandler.size<1}}size(){return this.idsByHandler.size}}class f{constructor(){this.simpleSubscriptions=new Map,this.paramSubscriptions=new Map}add({namespace:e,key:t,parameter:n},r){var o,s,i,a,c;if(n){if(!this.paramSubscriptions.has(e))return void this.paramSubscriptions.set(e,new Map([[t,new Map([[n,r]])]]));if(!(null===(o=this.paramSubscriptions.get(e))||void 0===o?void 0:o.has(t)))return void(null===(s=this.paramSubscriptions.get(e))||void 0===s||s.set(t,new Map([[n,r]])));null===(a=null===(i=this.paramSubscriptions.get(e))||void 0===i?void 0:i.get(t))||void 0===a||a.set(n,r)}else{if(!this.simpleSubscriptions.has(e))return void this.simpleSubscriptions.set(e,new Map([[t,r]]));null===(c=this.simpleSubscriptions.get(e))||void 0===c||c.set(t,r)}}delete({namespace:e,key:t,parameter:n}){var r,o,s,i;n?(null===(o=null===(r=this.paramSubscriptions.get(e))||void 0===r?void 0:r.get(t))||void 0===o?void 0:o.delete(n))&&this.paramSubscriptions.get(e).get(t).size<1&&(null===(s=this.paramSubscriptions.get(e))||void 0===s||s.delete(t),this.paramSubscriptions.get(e).size<1&&this.paramSubscriptions.delete(e)):(null===(i=this.simpleSubscriptions.get(e))||void 0===i?void 0:i.delete(t))&&this.simpleSubscriptions.get(e).size<1&&this.simpleSubscriptions.delete(e)}get({namespace:e,key:t,parameter:n}){var r,o,s;return n?null===(s=null===(o=this.paramSubscriptions.get(e))||void 0===o?void 0:o.get(t))||void 0===s?void 0:s.get(n):null===(r=this.simpleSubscriptions.get(e))||void 0===r?void 0:r.get(t)}getOrAdd(e,t){let n=this.get(e);return n||(n=t(),this.add(e,n)),n}addOrUpdate(e,t,n){let r=this.get(e);return r=r?n(r):t(),this.add(e,r),r}getAllSubscriptions(){return[...Array.from(this.simpleSubscriptions.keys()).flatMap((e=>Array.from(this.simpleSubscriptions.get(e).keys()).flatMap((t=>({namespace:e,key:t}))))),...Array.from(this.paramSubscriptions.keys()).flatMap((e=>Array.from(this.paramSubscriptions.get(e).keys()).flatMap((t=>Array.from(this.paramSubscriptions.get(e).get(t).keys()).flatMap((n=>({namespace:e,key:t,parameter:n})))))))]}}class b{constructor(){this.subscriptions=new f}add(e,t){return this.subscriptions.getOrAdd(e,(()=>new v)).add(t)}get(e){var t,n;return null!==(n=null===(t=this.subscriptions.get(e))||void 0===t?void 0:t.get())&&void 0!==n?n:[]}getById(e,t){var n,r;return null!==(r=null===(n=this.subscriptions.get(e))||void 0===n?void 0:n.getHandlerById(t))&&void 0!==r?r:null}delete(e,t){var n,r;null!==(r=null===(n=this.subscriptions.get(e))||void 0===n?void 0:n.delete(t).isEmpty)&&void 0!==r&&r&&this.subscriptions.delete(e)}size(e){var t,n;return null!==(n=null===(t=this.subscriptions.get(e))||void 0===t?void 0:t.size())&&void 0!==n?n:0}isEmpty(e){return 0===this.size(e)}getAllSubscriptions(){return this.subscriptions.getAllSubscriptions()}getAllSubscriptionHandlerIds(){return this.subscriptions.getAllSubscriptions().reduce(((e,t)=>e.concat(this.get(t).map((({handlerId:e})=>({topic:t,handlerId:e}))))),[])}}class C{constructor(){this.map=new f}add(e,t){this.map.addOrUpdate(e,(()=>new Set([t])),(e=>e.add(t)))}delete(e,t){const n=this.map.get(e);n&&(n.delete(t),0===n.size&&this.map.delete(e))}get(e){var t;return[...null!==(t=this.map.get(e))&&void 0!==t?t:[]]}size(e){var t,n;return null!==(n=null===(t=this.map.get(e))||void 0===t?void 0:t.size)&&void 0!==n?n:0}isEmpty(e){return 0===this.size(e)}getAllSubscriptions(){return this.map.getAllSubscriptions()}}class x{constructor({sendMetric:e,metricName:t,metricOptions:n}){this.unit="Milliseconds",this.sendMetric=e,this.startTime=performance.now(),this.metricName=t,this.dimensions=(null==n?void 0:n.dimensions)?n.dimensions:{},this.optionalDimensions=(null==n?void 0:n.optionalDimensions)?n.optionalDimensions:{}}stopDurationCounter(){const e=Math.round(performance.now()-this.startTime);return this.sendMetric({metricName:this.metricName,unit:this.unit,value:e,dimensions:this.dimensions,optionalDimensions:this.optionalDimensions}),{duration:e}}}function I({metricData:e,time:t,namespace:n},r){var o,s;return{type:"metric",namespace:n,metricName:e.metricName,unit:e.unit,value:e.value,time:t,dimensions:null!==(o=e.dimensions)&&void 0!==o?o:{},optionalDimensions:null!==(s=e.optionalDimensions)&&void 0!==s?s:{},messageOrigin:r}}class M{constructor(e){this._proxy=null,this.namespace=e.namespace,e.provider&&"function"==typeof e.provider?this.providerFactory=e.provider:this.provider=e.provider}recordSuccess(e,t){var n;const r=Object.assign({},null!==(n=null==t?void 0:t.dimensions)&&void 0!==n?n:{}),o=Object.assign(Object.assign({},t),{dimensions:r});this.recordCount(e,0,o)}recordError(e,t){var n;const r=Object.assign({},null!==(n=null==t?void 0:t.dimensions)&&void 0!==n?n:{}),o=Object.assign(Object.assign({},t),{dimensions:r});this.recordCount(e,1,o)}recordCount(e,t,n){this.sendMetric({metricName:e,unit:"Count",value:t,dimensions:null==n?void 0:n.dimensions,optionalDimensions:null==n?void 0:n.optionalDimensions})}startDurationCounter(e,t){return new x({sendMetric:this.sendMetric.bind(this),metricName:e,metricOptions:t})}sendMetric({metricName:e,unit:t,value:n,dimensions:r,optionalDimensions:o}){r&&function(e,t){if(Object.keys(e).length+Object.keys(null!=t?t:{}).length>30)throw new Error("Cannot add more than 30 dimensions to a metric")}(r,o);const s={metricName:e,unit:t,value:n,dimensions:r,optionalDimensions:o},i=new Date;this.getProxy().sendMetric({metricData:s,time:i,namespace:this.namespace})}getProvider(){return this.provider||(this.provider=this.providerFactory?this.providerFactory():s()),this.provider}getProxy(){return this._proxy||(this._proxy=this.getProvider().getProxy()),this._proxy}}const w="clientTimeout";function k(e,t){const{namespace:n,command:r,data:o}=e;return{namespace:n,reason:"Client Timeout",details:{command:r,requestData:o,timeoutMs:t},errorKey:w}}function S(e){return"object"==typeof e&&e.errorKey===w}const P="handlerNotFound",O="noResult";function A(e){return"object"==typeof e&&e.errorKey===O}class T{constructor(e){this.requestMap=new Map,this.logger=new Q({provider:e,source:"core.requestManager"})}processRequest(e){const{requestId:t}=e;return function(e,t,n){const r=Math.max(1,3e4);return new Promise(((o,s)=>{let a=!1;const c=setTimeout((()=>{n({timeoutMs:r,request:e}),s(k(e,r)),a=!0}),r);t((e=>{clearTimeout(c),a||(e.isError?s(new i(e)):o(e.data))}))}))}(e,(e=>this.requestMap.set(t,e)),(({request:e,timeoutMs:t})=>this.handleTimeout(e,t)))}processResponse(e){const{requestId:t}=e,n=this.requestMap.get(t);n?(n(e),this.requestMap.delete(t)):this.logger.error("Returned a response message with no handler",{message:e})}handleTimeout(e,t){const{requestId:n,namespace:r,command:o}=e;this.requestMap.delete(n),this.logger.error("Client request timeout",{requestId:n,namespace:r,command:o,timeoutMs:t})}}function j(e,t,n,r){return{type:"request",namespace:e,command:t,requestId:g(),data:n,messageOrigin:r}}var _=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n};function R(e){try{switch(e.type){case"acknowledge":case"error":case"childConnectionClose":default:return e;case"childDownstreamMessage":return Object.assign(Object.assign({},e),{message:R(e.message)});case"publish":{const{data:t}=e,n=_(e,["data"]);return Object.assign({},n)}case"response":if(e.isError)return Object.assign(Object.assign({},e),{details:{command:e.details.command}});{const{data:t}=e,n=_(e,["data"]);return Object.assign({},n)}}}catch(t){return{messageDetails:"error when sanitizing downstream message",message:e,error:t}}}class D{constructor(e,t){this.provider=e,this.relayChildUpstreamMessage=t,this.messagePorts=new Map,this.logger=new Q({provider:e,source:"childConnectionManager"})}addChannel(e){const{connectionId:t}=e;this.messagePorts.has(t)?this.logger.error("Attempted to add child connection that already exists. No action",{connectionId:t}):(this.setupPort(e),this.logger.debug("Child port added",{connectionId:t}))}updateChannelPort(e){var t;const{connectionId:n}=e,r=null===(t=this.messagePorts.get(n))||void 0===t?void 0:t.port;r?(r.onmessage=null,r.close(),this.setupPort(e),this.logger.info("Updated child port",{connectionId:n})):this.logger.error("Attempted to update child connection that does not exist No action",{connectionId:n})}setupPort({connectionId:e,port:t,providerId:n}){const r=this.createMessageHandler(e,n);t.addEventListener("message",r),t.start(),this.messagePorts.set(e,{port:t,handler:r,providerId:n}),this.relayChildUpstreamMessage({type:"childUpstream",connectionId:e,sourceProviderId:n,parentProviderId:this.provider.id,message:{type:"childConnectionReady"}})}handleDownstreamMessage({connectionId:e,message:t,targetProviderId:n}){const r=this.messagePorts.get(e);if(!r)return void this.logger.warn("Attempted to route downstream message to child message port that does not exist",{connectionId:e,message:R(t)});const{port:o,providerId:s}=r;s&&s!==n?this.logger.error("Downstream target message did not match target provider id. Not sending message.",{connectionId:e,targetProviderId:n,actualProviderId:s,message:R(t)}):o.postMessage(t)}handleCloseMessage({connectionId:e}){const t=this.messagePorts.get(e);if(!t)return void this.logger.warn("Attempted to close child message port that was not found",{connectionId:e});const{port:n,handler:r}=t;n.removeEventListener("message",r),n.close(),this.messagePorts.delete(e),this.logger.debug("Removed child message channel",{connectionId:e})}createMessageHandler(e,t){return n=>this.relayChildUpstreamMessage({type:"childUpstream",sourceProviderId:t,parentProviderId:this.provider.id,connectionId:e,message:n.data})}}class H{constructor(e){this.errorHandlers=new Set,this.logger=new Q({provider:e,source:"core.proxy.error"})}invoke(e){const{message:t,key:n,details:r,isFatal:o,connectionStatus:s}=e;this.logger.error(t,{key:n,details:r,isFatal:o,connectionStatus:s},{duplicateMessageToConsole:!0,remoteIgnore:!0}),[...this.errorHandlers].forEach((t=>{try{t(e)}catch(t){this.logger.error("An error occurred within a AmazonConnectErrorHandler",{handlerError:t,originalError:e})}}))}onError(e){this.errorHandlers.add(e)}offError(e){this.errorHandlers.delete(e)}}class L{constructor({provider:e,sendHealthCheck:t,getUpstreamMessageOrigin:n}){this.connectionId=null,this.healthCheckInterval=null,this.healthCheckTimeout=null,this.sendHealthCheck=t,this.getUpstreamMessageOrigin=n,this.sendHealthCheckInterval=null,this.lastHealthCheckResponse=null,this._status="unknown",this.logger=new Q({source:"core.proxy.health-check",provider:e,mixin:()=>({connectionId:this.connectionId})}),this.events=new u({provider:e,loggerKey:"core.proxy.health-check"})}get status(){return this._status}get isRunning(){return null!==this.sendHealthCheckInterval}get lastCheckCounter(){var e,t;return null!==(t=null===(e=this.lastHealthCheckResponse)||void 0===e?void 0:e.counter)&&void 0!==t?t:null}get lastCheckTime(){var e,t;return null!==(t=null===(e=this.lastHealthCheckResponse)||void 0===e?void 0:e.time)&&void 0!==t?t:null}start({healthCheckInterval:e,connectionId:t}){this.connectionId=t,this.healthCheckInterval=e,this.clearInterval(),e<=0?this.logger.debug("Health check disabled"):e<1e3?this.logger.error("Health check interval is less than 1 second. Not running",{interval:e}):(this.sendHealthCheckMessage(),this.sendHealthCheckInterval=setInterval((()=>this.sendHealthCheckMessage()),e),this.startTimeout())}stop(){this.clearInterval(),this.clearTimeout()}handleResponse(e){this.setHealthy({time:e.time,counter:e.counter})}sendHealthCheckMessage(){this.sendHealthCheck({type:"healthCheck",messageOrigin:this.getUpstreamMessageOrigin()})}startTimeout(){this.healthCheckInterval?(this.clearTimeout(),this.healthCheckTimeout=setTimeout((()=>{this.setUnhealthy()}),3*this.healthCheckInterval)):this.logger.error("Health check interval not set. Cannot start timeout")}clearInterval(){this.sendHealthCheckInterval&&(clearInterval(this.sendHealthCheckInterval),this.sendHealthCheckInterval=null)}clearTimeout(){this.healthCheckTimeout&&(clearTimeout(this.healthCheckTimeout),this.healthCheckTimeout=null)}setUnhealthy(){if("unhealthy"!==this._status){const e=this._status;this.logger.info("Connection unhealthy",{previousStatus:e}),this._status="unhealthy",this.emitStatusChanged("unhealthy",e)}}setHealthy(e){if(this.lastHealthCheckResponse=Object.assign({},e),"healthy"!==this._status){const e=this._status;this.logger.debug("Connection healthy",{previousStatus:e}),this._status="healthy",this.emitStatusChanged("healthy",e)}this.startTimeout()}emitStatusChanged(e,t){var n,r,o,s;this.events.emit(L.statusChangedKey,{status:e,previousStatus:t,lastCheckTime:null!==(r=null===(n=this.lastHealthCheckResponse)||void 0===n?void 0:n.time)&&void 0!==r?r:null,lastCheckCounter:null!==(s=null===(o=this.lastHealthCheckResponse)||void 0===o?void 0:o.counter)&&void 0!==s?s:null})}onStatusChanged(e){this.events.on(L.statusChangedKey,e)}offStatusChanged(e){this.events.off(L.statusChangedKey,e)}}L.statusChangedKey="statusChanged";class E{constructor(e){this.status="notConnected",this.changeHandlers=new Set,this.logger=new Q({source:"core.proxy.connection-status-manager",provider:e,mixin:()=>({status:this.status})})}getStatus(){return this.status}update(e){this.status=e.status,this.logger.trace("Proxy Connection Status Changed",{status:e.status}),[...this.changeHandlers].forEach((t=>{try{t(e)}catch(e){this.logger.error("An error occurred within a ProxyConnectionChangedHandler",{error:e})}}))}onChange(e){this.changeHandlers.add(e)}offChange(e){this.changeHandlers.delete(e)}}class N{constructor(e){this.provider=e,this.logger=new Q({source:"core.proxy",provider:e,mixin:()=>({proxyType:this.proxyType,connectionId:this.connectionId})}),this.requestManager=new T(e),this.status=new E(e),this.errorService=new H(e),this.upstreamMessageQueue=[],this.connectionEstablished=!1,this.isInitialized=!1,this.subscriptions=new b,this.connectionId=null,this.channelManager=new D(e,this.sendOrQueueMessageToSubject.bind(this)),this.healthCheck=new L({provider:e,sendHealthCheck:this.sendOrQueueMessageToSubject.bind(this),getUpstreamMessageOrigin:this.getUpstreamMessageOrigin.bind(this)})}init(){if(this.isInitialized)throw new Error("Proxy already initialized");this.isInitialized=!0,this.initProxy()}request(e,t,n,r){const o=j(e,t,n,null!=r?r:this.getUpstreamMessageOrigin()),s=this.requestManager.processRequest(o);return this.sendOrQueueMessageToSubject(o),s}subscribe(e,t,n){const{handlerId:r}=this.subscriptions.add(e,t),o={type:"subscribe",topic:e,messageOrigin:null!=n?n:this.getUpstreamMessageOrigin(),handlerId:r};this.sendOrQueueMessageToSubject(o)}unsubscribe(e,t,n){if(this.subscriptions.delete(e,t),this.subscriptions.isEmpty(e)){const t={type:"unsubscribe",topic:e,messageOrigin:null!=n?n:this.getUpstreamMessageOrigin()};this.sendOrQueueMessageToSubject(t)}}log(e){const t=V(e,this.addContextToLogger(),this.getUpstreamMessageOrigin());this.sendOrQueueMessageToSubject(t)}sendLogMessage(e){"log"===e.type?(e.context=Object.assign(Object.assign({},e.context),this.addContextToLogger()),this.sendOrQueueMessageToSubject(e)):this.logger.error("Attempted to send invalid log message",{message:e})}sendMetric({metricData:e,time:t,namespace:n}){const r=I({metricData:e,time:t,namespace:n},this.getUpstreamMessageOrigin());this.sendOrQueueMessageToSubject(r)}sendMetricMessage(e){"metric"===e.type?this.sendOrQueueMessageToSubject(e):this.logger.error("Attempted to send invalid metric message",{metricMessage:e})}sendOrQueueMessageToSubject(e){this.connectionEstablished?this.sendMessageToSubject(e):this.upstreamMessageQueue.push(e)}consumerMessageHandler(e){if(!this.isInitialized)return void this.logger.error("Attempted to process message from subject prior to proxy being initializing. Message not processed",{originalMessageEventData:e.data});const{data:t}=e;if(!("type"in t))return void this.logger.warn("Unknown inbound message",{originalMessageEventData:t});const n=t;this.handleMessageFromSubject(n)}handleMessageFromSubject(e){this.handleDefaultMessageFromSubject(e)}handleDefaultMessageFromSubject(e){switch(e.type){case"acknowledge":this.handleConnectionAcknowledge(e);break;case"response":this.handleResponse(e);break;case"publish":this.handlePublish(e);break;case"error":this.handleError(e);break;case"childDownstreamMessage":this.channelManager.handleDownstreamMessage(e);break;case"childConnectionClose":this.channelManager.handleCloseMessage(e);break;case"healthCheckResponse":this.healthCheck.handleResponse(e);break;default:return void this.logger.error("Unknown inbound message",{originalMessageEventData:e})}}handleConnectionAcknowledge(e){for(this.connectionId=e.connectionId,this.status.update({status:"ready",connectionId:e.connectionId}),this.connectionEstablished=!0;this.upstreamMessageQueue.length;){const e=this.upstreamMessageQueue.shift();this.sendMessageToSubject(e)}this.healthCheck.start(e)}handleResponse(e){this.requestManager.processResponse(e)}handlePublish(e){const{handlerId:t,topic:n}=e;if(t){const r=this.subscriptions.getById(n,t);r&&this.handleAsyncSubscriptionHandlerInvoke({handler:r,handlerId:t},e)}else this.subscriptions.get(n).map((t=>{this.handleAsyncSubscriptionHandlerInvoke(t,e)}))}handleError(e){if(e.isFatal){const{message:t,type:n}=e,r=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n}(e,["message","type"]);this.status.update({status:"error",reason:t,details:r})}this.publishError({message:e.message,key:e.key,details:e.details,isFatal:e.isFatal,proxyStatus:e.status})}publishError(e){const t=Object.assign(Object.assign({},e),{connectionStatus:this.connectionStatus});this.errorService.invoke(t)}handleAsyncSubscriptionHandlerInvoke(e,t){return n=this,r=arguments,s=function*({handler:e,handlerId:t},{topic:n,data:r}){try{yield e(r)}catch(e){this.logger.error("An error occurred when handling subscription",{topic:n,error:e,handlerId:t})}},new((o=void 0)||(o=Promise))((function(e,t){function i(e){try{c(s.next(e))}catch(e){t(e)}}function a(e){try{c(s.throw(e))}catch(e){t(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(i,a)}c((s=s.apply(n,r||[])).next())}));var n,r,o,s}get connectionStatus(){return this.status.getStatus()}onError(e){this.errorService.onError(e)}offError(e){this.errorService.offError(e)}onConnectionStatusChange(e){this.status.onChange(e)}offConnectionStatusChange(e){this.status.offChange(e)}onHealthCheckStatusChanged(e){this.healthCheck.onStatusChanged(e)}offHealthCheckStatusChanged(e){this.healthCheck.offStatusChanged(e)}addChildChannel(e){this.channelManager.addChannel(e)}updateChildChannelPort(e){this.channelManager.updateChannelPort(e)}resetConnection(e){var t;this.connectionEstablished=!1,this.status.update({status:"reset",reason:e});const n=this.subscriptions.getAllSubscriptionHandlerIds();this.logger.info("Resetting proxy",{reason:e,subscriptionHandlerCount:null!==(t=null==n?void 0:n.length)&&void 0!==t?t:-1}),null==n||n.map((({topic:e,handlerId:t})=>({type:"subscribe",topic:e,messageOrigin:this.getUpstreamMessageOrigin(),handlerId:t}))).forEach((e=>this.sendOrQueueMessageToSubject(e)))}}var B;class q{constructor(e){this.handlersMap=new Map,this.provider=e,this.logger=new Q({source:"subscription-handler-relay",provider:e,mixin:()=>({namespace:this.namespace,topicKey:this.topicKey})})}get supportsParameter(){return!0}on(e,t){if(t&&!this.supportsParameter)throw new Error("on provided unsupported parameter");const n=this.getParameterInternalHandlerMap(e);if(n.has(t))return;const r=n=>{return r=this,o=void 0,i=function*(){if(this.skipRelay(n))return;let r;try{r=yield this.translate(n)}catch(e){return void this.logger.error("An error occurred when translating event",{error:e,parameter:t})}try{yield e(r)}catch(e){this.logger.error("Error in event handler",{error:e,parameter:t})}},new((s=void 0)||(s=Promise))((function(e,t){function n(e){try{c(i.next(e))}catch(e){t(e)}}function a(e){try{c(i.throw(e))}catch(e){t(e)}}function c(t){var r;t.done?e(t.value):(r=t.value,r instanceof s?r:new s((function(e){e(r)}))).then(n,a)}c((i=i.apply(r,o||[])).next())}));var r,o,s,i};n.set(t,r),this.getProxy().subscribe({key:this.topicKey,parameter:t},r)}off(e,t){var n;if(t&&!this.supportsParameter)throw new Error("off provided unsupported parameter");const r=null===(n=this.handlersMap.get(e))||void 0===n?void 0:n.get(t);if(!r)return;const o=this.handlersMap.get(e);(null==o?void 0:o.delete(t))&&o.size<1&&this.handlersMap.delete(e),this.getProxy().unsubscribe({key:this.topicKey,parameter:t},r)}skipRelay(e){return!1}destroy(){const e=this.getProxy();for(const[t,n]of this.handlersMap){for(const[t,r]of n)e.unsubscribe({key:this.topicKey,parameter:t},r),n.delete(t);this.handlersMap.delete(t)}}getParameterInternalHandlerMap(e){return this.handlersMap.has(e)||this.handlersMap.set(e,new Map),this.handlersMap.get(e)}getProxy(){if(!this.proxy){const e=this.provider.getProxy();this.proxy=y(e,this.namespace)}return this.proxy}}class z{constructor(e,t){this.timeoutMs=t,this.onCancelled=e,this.timeout=setTimeout((()=>this.handleCancel()),this.timeoutMs),this.status="running",this.logger=new Q({source:"core.utility.timeout-tracker",mixin:()=>({timeoutMs:this.timeoutMs,timeoutTrackerStatus:this.status})})}static start(e,t){return new z(e,t)}complete(){switch(this.status){case"running":return this.handleComplete();case"completed":return this.logger.debug("TimeoutTracker already marked complete. No action."),!0;case"cancelled":return this.logger.info("Attempted to complete a TimeoutTracker that has already been cancelled"),!1}}isCancelled(){return"cancelled"===this.status}getStatus(){return this.status}handleCancel(){switch(this.status){case"running":this.status="cancelled",this.logger.info("TimeoutTracker has timed out. Invoking onCancelled Handler"),this.invokeOnCancelled();break;case"completed":this.logger.debug("Cancel operation for TimerTracker invoked after already completed. No action.");break;default:throw new Error("Cancel operation in TimerTracker called during an unexpected time.")}}handleComplete(){return this.status="completed",clearTimeout(this.timeout),!0}invokeOnCancelled(){try{this.onCancelled({timeoutMs:this.timeoutMs})}catch(e){this.logger.error("Error when attempting to invoke TimeoutTrackerCancelledHandler",{error:e})}}}class F{constructor({config:e,proxyFactory:t}){if(this._id=g(),!t)throw new Error("Attempted to get Proxy before setting up factory");if(!e)throw new Error("Failed to include config");this.proxyFactory=t,this._config=e}get id(){return this._id}getProxy(){return this.proxy||(this.proxy=this.proxyFactory(this),this.proxy.init()),this.proxy}get config(){return Object.assign({},this._config)}onError(e){this.getProxy().onError(e)}offError(e){this.getProxy().offError(e)}static initializeProvider(e){if(this.isInitialized){const e="Attempted to initialize provider more than one time.",t={};try{const t=s();new Q({source:"core.amazonConnectProvider.init",provider:t}).error(e)}catch(e){t.loggingError=null==e?void 0:e.message}throw new i({errorKey:"attemptInitializeMultipleProviders",reason:e,details:t})}return function(e){if(r)throw new Error("Global Provider is already set");r=e}(e),this.isInitialized=!0,e.getProxy(),e}}function K(e,t,n){if(n)switch(e){case B.error:console.error(t,n);break;case B.warn:console.warn(t,n);break;case B.info:console.info(t,n);break;case B.debug:console.debug(t,n);break;case B.trace:console.trace(t,n);break;default:console.log(t,n)}else switch(e){case B.error:console.error(t);break;case B.warn:console.warn(t);break;case B.info:console.info(t);break;case B.debug:console.debug(t);break;case B.trace:console.trace(t);break;default:console.log(t)}}F.isInitialized=!1,function(e){e[e.trace=1]="trace",e[e.debug=2]="debug",e[e.info=3]="info",e[e.warn=4]="warn",e[e.error=5]="error"}(B||(B={}));class U{constructor(e){this.mixin=e}getTransformedData(e,t){return this.mixin?Object.assign(Object.assign({},null!=t?t:{}),this.mixin(null!=t?t:{},e)):t}}class Q{constructor(e){this._proxy=null,this._logToConsoleLevel=null,this.loggerId=p(8),"string"==typeof e?(this.source=e,this.dataTransformer=new U(void 0)):(this.source=e.source,e.provider&&"function"==typeof e.provider?this.providerFactory=e.provider:this.provider=e.provider,this.dataTransformer=new U(e.mixin),this.logOptions=e.options)}trace(e,t,n){this.log(B.trace,e,t,n)}debug(e,t,n){this.log(B.debug,e,t,n)}info(e,t,n){this.log(B.info,e,t,n)}warn(e,t,n){this.log(B.warn,e,t,n)}error(e,t,n){this.log(B.error,e,t,n)}log(e,t,n,r){const o=this.dataTransformer.getTransformedData(e,n);this.ignoreRemote(r)||this.getProxy().log({level:e,source:this.source,loggerId:this.loggerId,message:t,data:o}),this.applyDuplicateMessageToConsole(e,r)&&K(e,t,o)}getProvider(){return this.provider||(this.provider=this.providerFactory?this.providerFactory():s()),this.provider}getProxy(){return this._proxy||(this._proxy=this.getProvider().getProxy()),this._proxy}applyDuplicateMessageToConsole(e,t){return(null==t?void 0:t.duplicateMessageToConsole)||this.getLogConsoleLevel()<=e}getLogConsoleLevel(){var e,t,n,r;return this._logToConsoleLevel||(this._logToConsoleLevel=(null===(e=this.logOptions)||void 0===e?void 0:e.minLogToConsoleLevelOverride)?this.logOptions.minLogToConsoleLevelOverride:null!==(r=null===(n=null===(t=this.getProvider().config)||void 0===t?void 0:t.logging)||void 0===n?void 0:n.minLogToConsoleLevel)&&void 0!==r?r:B.error),this._logToConsoleLevel}ignoreRemote(e){var t,n,r;return null!==(n=null===(t=this.logOptions)||void 0===t?void 0:t.remoteIgnore)&&void 0!==n&&n||null!==(r=null==e?void 0:e.remoteIgnore)&&void 0!==r&&r}}function V({level:e,source:t,message:n,loggerId:r,data:o},s,i){const a=o?JSON.parse(JSON.stringify(o)):void 0;return{type:"log",level:e,time:new Date,source:t,message:n,loggerId:r,data:a,context:s,messageOrigin:i}}class G{constructor(e,t){this.engineContext=e,this.moduleNamespace=t}get proxy(){if(!this.moduleProxy){const e=this.engineContext.getProxy(),t=this.moduleNamespace;this.moduleProxy=y(e,t)}return this.moduleProxy}createLogger(e){return this.engineContext.createLogger(e)}createMetricRecorder(e){return this.engineContext.createMetricRecorder(e)}}class W{constructor(e){this.provider=e}getProxy(){return this.getProvider().getProxy()}getModuleContext(e){return new G(this,e)}getProvider(){return this.provider?this.provider:s()}createLogger(e){return new Q("object"==typeof e?Object.assign(Object.assign({},e),{provider:()=>this.getProvider()}):{source:e,provider:()=>this.getProvider()})}createMetricRecorder(e){return new M("object"==typeof e?Object.assign(Object.assign({},e),{provider:()=>this.getProvider()}):{namespace:e,provider:()=>this.getProvider()})}}class ${constructor(e,t){var n;this.namespace=e,this.context=null!==(n=null==t?void 0:t.context)&&void 0!==n?n:new W(null==t?void 0:t.provider).getModuleContext(e)}}const J="1.0.6"},2732:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},2813:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AppProxy=void 0;const r=n(1404),o=n(6665);class s extends r.Proxy{constructor(e,t){super(e),this.channel=new MessageChannel,this.lifecycleManager=t,this.appLogger=new r.ConnectLogger({source:"app.appProxy",provider:e})}get proxyType(){return"AppProxy"}sendLifecycleHandlerCompleted(e,t){const n={type:"appLifecycleHandlerCompleted",stage:t,appInstanceId:e};this.sendOrQueueMessageToSubject(n)}tryCloseApp(e,t,n){const r={type:"closeApp",isFatalError:null!=t&&t,message:e,data:n};this.sendOrQueueMessageToSubject(r)}publish(e,t){const n={type:"appPublish",topic:e,data:t};this.sendOrQueueMessageToSubject(n)}initProxy(){const e={type:"connect-app-host-init",sdkVersion:r.sdkVersion,providerId:this.provider.id};this.status.update({status:"initializing"}),this.channel.port1.onmessage=e=>this.consumerMessageHandler(e),this.connectionTimer=r.TimeoutTracker.start(this.connectionTimeout.bind(this),(0,o.getConnectionTimeout)(this.provider.config)),window.parent.postMessage(e,"*",[this.channel.port2]),this.appLogger.debug("Send connect message to configure proxy")}sendMessageToSubject(e){this.channel.port1.postMessage(e)}getUpstreamMessageOrigin(){if(null===document||void 0===document?void 0:document.location){const{origin:e,pathname:t}=document.location;return{_type:"app",providerId:this.provider.id,origin:e,path:t}}return{_type:"app",providerId:this.provider.id,origin:"unknown",path:"unknown"}}handleConnectionAcknowledge(e){this.connectionTimer.complete()?super.handleConnectionAcknowledge(e):this.appLogger.error("Workspace connection acknowledge received after timeout. App is not connected to workspace.",{timeout:this.connectionTimer.timeoutMs})}handleMessageFromSubject(e){"appLifecycle"===e.type?this.lifecycleManager.handleLifecycleChangeMessage(e).catch((e=>{this.appLogger.error("An error occurred when invoking handleLifecycleChangeMessage",{error:e})})):super.handleMessageFromSubject(e)}connectionTimeout(e){this.status.update({status:"error",reason:"Workspace connection timeout",details:Object.assign({},e)}),this.publishError({message:"App failed to connect to workspace in the allotted time",key:"workspaceConnectTimeout",details:Object.assign({},e),isFatal:!0,proxyStatus:{initialized:!1}})}addContextToLogger(){const{isRunning:e}=this.lifecycleManager.appState;if(null===document||void 0===document?void 0:document.location){const{origin:t,pathname:n}=document.location;return{appIsRunning:e,app:{origin:t,path:n}}}return{appIsRunning:e,app:{origin:"unknown",path:"unknown"}}}}t.AppProxy=s},3179:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.VoiceClient=void 0;const o=n(1404),s=n(7570),i=n(551);class a extends o.ConnectClient{constructor(e){super(s.voiceNamespace,e)}getPhoneNumber(e){return r(this,void 0,void 0,(function*(){const{phoneNumber:t}=yield this.context.proxy.request(i.VoiceRoutes.getPhoneNumber,{contactId:e});return t}))}getInitialCustomerPhoneNumber(e){return r(this,void 0,void 0,(function*(){const{phoneNumber:t}=yield this.context.proxy.request(i.VoiceRoutes.getInitialCustomerPhoneNumber,{contactId:e});return t}))}listDialableCountries(){return this.context.proxy.request(i.VoiceRoutes.listDialableCountries)}getOutboundCallPermission(){return r(this,void 0,void 0,(function*(){const{outboundCallPermission:e}=yield this.context.proxy.request(i.VoiceRoutes.getOutboundCallPermission);return e}))}createOutboundCall(e,t){return this.context.proxy.request(i.VoiceRoutes.createOutboundCall,{phoneNumber:e,options:t})}}t.VoiceClient=a},3481:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.AppContactScope=void 0,function(e){e.CurrentContactId="CURRENT_CONTACT"}(n||(t.AppContactScope=n={}))},3872:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.contactNamespace=void 0,t.contactNamespace="aws.connect.contact"},4015:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AmazonConnectApp=void 0;const r=n(1404),o=n(5763),s=n(9463);class i extends r.AmazonConnectProviderBase{constructor(e){super({config:e,proxyFactory:()=>this.createProxy()}),this.lifecycleManager=new o.LifecycleManager(this),this.logger=new r.ConnectLogger({provider:this,source:"app.provider"})}static init(e){const t=new i(e);return i.initializeProvider(t),{provider:t}}static get default(){return(0,r.getGlobalProvider)("AmazonConnectApp has not been initialized")}createProxy(){return new s.AppProxy(this,this.lifecycleManager)}onStart(e,t){this.lifecycleManager.onStart(e,t)}onStop(e){this.lifecycleManager.onStop(e)}offStart(e){this.lifecycleManager.offStart(e)}offStop(e){this.lifecycleManager.offStop(e)}sendCloseAppRequest(e){this.getProxy().tryCloseApp(e,!1)}sendError(e,t){this.logger.error(e,t)}sendFatalError(e,t){this.getProxy().tryCloseApp(e,!0,t)}subscribe(e,t){this.getProxy().subscribe(e,t)}unsubscribe(e,t){this.getProxy().unsubscribe(e,t)}publish(e,t){this.getProxy().publish(e,t)}}t.AmazonConnectApp=i},4446:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},4884:(e,t,n)=>{n.d(t,{G:()=>a});var r=n(9282);function o(e){return Object.fromEntries(Object.entries(e.tokens).map((([e,t])=>[e,"string"==typeof t?t:null==t?void 0:t.dark])).filter((e=>void 0!==e[1])))}function s({fontFamily:e,brandColor:t,brandColorActive:n,lightBrandBackground:r}){const s="string"==typeof n?n:{light:null==n?void 0:n.dark,dark:null==n?void 0:n.light},i={tokens:{fontFamilyBase:e,colorBackgroundButtonNormalActive:{light:r},colorBackgroundButtonNormalHover:{light:r},colorBackgroundButtonPrimaryActive:n,colorBackgroundButtonPrimaryDefault:t,colorBackgroundButtonPrimaryHover:n,colorBackgroundControlChecked:t,colorBackgroundDropdownItemFilterMatch:{light:r},colorBackgroundItemSelected:{light:r},colorBackgroundLayoutToggleSelectedActive:t,colorBackgroundLayoutToggleSelectedDefault:t,colorBackgroundLayoutToggleSelectedHover:n,colorBackgroundSegmentActive:t,colorBackgroundToggleCheckedDisabled:s,colorBorderButtonNormalActive:n,colorBorderButtonNormalDefault:t,colorBorderButtonNormalHover:n,colorBorderItemFocused:t,colorBorderItemSelected:t,colorTextAccent:t,colorTextButtonNormalActive:n,colorTextButtonNormalDefault:t,colorTextButtonNormalHover:n,colorTextDropdownItemFilterMatch:t,colorTextLayoutToggleHover:t,colorTextLinkDefault:t,colorTextLinkHover:n,colorTextSegmentHover:t}};return function({tokens:e}){for(const t of Object.keys(e)){const n=t;void 0===e[n]&&delete e[n]}}(i),i.contexts={"top-navigation":{tokens:o(i)},header:{tokens:o(i)},alert:{tokens:{colorBackgroundControlChecked:t,colorBackgroundDropdownItemFilterMatch:{light:r},colorBackgroundItemSelected:{light:r},colorBackgroundSegmentActive:t,colorBackgroundToggleCheckedDisabled:s,colorTextAccent:t,colorTextDropdownItemFilterMatch:t,colorTextLinkDefault:t,colorTextLinkHover:n,colorTextSegmentHover:t}}},i}const i={brandColor:{light:"#077398",dark:"#7CA2BB"},brandColorActive:{light:"#065B78",dark:"#A7C1D1"},lightBrandBackground:"#F2FAFC"};function a(){(0,r.A)({theme:s(i)})}},5763:function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.LifecycleManager=void 0,o(n(2732),t);var s=n(8781);Object.defineProperty(t,"LifecycleManager",{enumerable:!0,get:function(){return s.LifecycleManager}})},6375:function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.contactNamespace=t.ContactClient=t.AgentClient=void 0;var s=n(6428);Object.defineProperty(t,"AgentClient",{enumerable:!0,get:function(){return s.AgentClient}});var i=n(8367);Object.defineProperty(t,"ContactClient",{enumerable:!0,get:function(){return i.ContactClient}});var a=n(3872);Object.defineProperty(t,"contactNamespace",{enumerable:!0,get:function(){return a.contactNamespace}}),o(n(8865),t),o(n(1393),t),o(n(4446),t)},6428:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.AgentClient=void 0;const o=n(1404),s=n(3872),i=n(8865),a=n(1393);class c extends o.ConnectClient{constructor(e){super(s.contactNamespace,e)}getARN(){return r(this,void 0,void 0,(function*(){const{ARN:e}=yield this.context.proxy.request(i.AgentRoutes.getARN);return e}))}getName(){return r(this,void 0,void 0,(function*(){const{name:e}=yield this.context.proxy.request(i.AgentRoutes.getName);return e}))}getState(){return this.context.proxy.request(i.AgentRoutes.getState)}getRoutingProfile(){return this.context.proxy.request(i.AgentRoutes.getRoutingProfile)}getChannelConcurrency(){return this.context.proxy.request(i.AgentRoutes.getChannelConcurrency)}getExtension(){return r(this,void 0,void 0,(function*(){const{extension:e}=yield this.context.proxy.request(i.AgentRoutes.getExtension);return e}))}getDialableCountries(){return r(this,void 0,void 0,(function*(){const{dialableCountries:e}=yield this.context.proxy.request(i.AgentRoutes.getDialableCountries);return e}))}onStateChanged(e){this.context.proxy.subscribe({key:a.AgentTopicKey.StateChanged},e)}offStateChanged(e){this.context.proxy.unsubscribe({key:a.AgentTopicKey.StateChanged},e)}setAvailabilityState(e){return this.context.proxy.request(i.AgentRoutes.setAvailabilityState,{agentStateARN:e})}setAvailabilityStateByName(e){return this.context.proxy.request(i.AgentRoutes.setAvailabilityStateByName,{agentStateName:e})}setOffline(){return this.context.proxy.request(i.AgentRoutes.setOffline,{})}listAvailabilityStates(){return this.context.proxy.request(i.AgentRoutes.listAvailabilityStates)}listQuickConnects(e,t){return this.context.proxy.request(i.AgentRoutes.listQuickConnects,{queueARNs:e,options:t})}}t.AgentClient=c},6665:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.maxValue=t.minValue=t.defaultValue=void 0,t.getConnectionTimeout=function(e){var t,n;return Math.max(1,Math.min(6e4,null!==(n=null===(t=e.workspace)||void 0===t?void 0:t.connectionTimeout)&&void 0!==n?n:5e3))},t.defaultValue=5e3,t.minValue=1,t.maxValue=6e4},7570:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.voiceNamespace=void 0,t.voiceNamespace="aws.connect.voice"},7792:function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.AppContactScope=t.AmazonConnectApp=void 0;var s=n(4015);Object.defineProperty(t,"AmazonConnectApp",{enumerable:!0,get:function(){return s.AmazonConnectApp}});var i=n(3481);Object.defineProperty(t,"AppContactScope",{enumerable:!0,get:function(){return i.AppContactScope}}),o(n(5763),t)},8281:function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.VoiceClient=t.voiceNamespace=void 0;var s=n(7570);Object.defineProperty(t,"voiceNamespace",{enumerable:!0,get:function(){return s.voiceNamespace}}),o(n(551),t),o(n(9144),t);var i=n(3179);Object.defineProperty(t,"VoiceClient",{enumerable:!0,get:function(){return i.VoiceClient}})},8367:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.ContactClient=void 0;const o=n(1404),s=n(3872),i=n(8865),a=n(1393);class c extends o.ConnectClient{constructor(e){super(s.contactNamespace,e)}getAttributes(e,t){const n={contactId:e,attributes:t};return this.context.proxy.request(i.ContactRoutes.getAttributes,n)}getAttribute(e,t){return r(this,void 0,void 0,(function*(){return(yield this.getAttributes(e,[t]))[t]}))}getInitialContactId(e){return r(this,void 0,void 0,(function*(){return(yield this.context.proxy.request(i.ContactRoutes.getInitialContactId,{contactId:e})).initialContactId}))}getType(e){return r(this,void 0,void 0,(function*(){return(yield this.context.proxy.request(i.ContactRoutes.getType,{contactId:e})).type}))}getStateDuration(e){return r(this,void 0,void 0,(function*(){return(yield this.context.proxy.request(i.ContactRoutes.getStateDuration,{contactId:e})).stateDuration}))}getQueue(e){return this.context.proxy.request(i.ContactRoutes.getQueue,{contactId:e})}getQueueTimestamp(e){return r(this,void 0,void 0,(function*(){return(yield this.context.proxy.request(i.ContactRoutes.getQueueTimestamp,{contactId:e})).queueTimestamp}))}onStartingAcw(e,t){this.context.proxy.subscribe({key:a.ContactLifecycleTopicKey.StartingACW,parameter:t},e)}onDestroyed(e,t){this.context.proxy.subscribe({key:a.ContactLifecycleTopicKey.Destroyed,parameter:t},e)}onConnected(e,t){this.context.proxy.subscribe({key:a.ContactLifecycleTopicKey.Connected,parameter:t},e)}onMissed(e,t){this.context.proxy.subscribe({key:a.ContactLifecycleTopicKey.Missed,parameter:t},e)}offStartingAcw(e,t){this.context.proxy.unsubscribe({key:a.ContactLifecycleTopicKey.StartingACW,parameter:t},e)}offDestroyed(e,t){this.context.proxy.unsubscribe({key:a.ContactLifecycleTopicKey.Destroyed,parameter:t},e)}offMissed(e,t){this.context.proxy.unsubscribe({key:a.ContactLifecycleTopicKey.Missed,parameter:t},e)}offConnected(e,t){this.context.proxy.unsubscribe({key:a.ContactLifecycleTopicKey.Connected,parameter:t},e)}getChannelType(e){return r(this,void 0,void 0,(function*(){return yield this.context.proxy.request(i.ContactRoutes.getChannelType,{contactId:e})}))}addParticipant(e,t){return this.context.proxy.request(i.ContactRoutes.addParticipant,{contactId:e,quickConnect:t})}transfer(e,t){return this.context.proxy.request(i.ContactRoutes.transfer,{contactId:e,quickConnect:t})}onCleared(e,t){this.context.proxy.subscribe({key:a.ContactLifecycleTopicKey.Cleared,parameter:t},e)}offCleared(e,t){this.context.proxy.unsubscribe({key:a.ContactLifecycleTopicKey.Cleared,parameter:t},e)}accept(e){return this.context.proxy.request(i.ContactRoutes.accept,{contactId:e})}clear(e){return this.context.proxy.request(i.ContactRoutes.clear,{contactId:e})}}t.ContactClient=c},8781:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.LifecycleManager=void 0;const o=n(1404),s=n(549);t.LifecycleManager=class{constructor(e){this.provider=e,this.startHandlers=new Set,this.stopHandlers=new Set,this.state={isRunning:!1},this.isCreated=!1,this.isDestroyed=!1,this.logger=new o.ConnectLogger({source:"app.lifecycleManager",provider:e,mixin:()=>({state:this.state,isCreated:this.isCreated,isDestroyed:this.isDestroyed})})}handleLifecycleChangeMessage(e){const t=new s.AppContext(this.provider,e.appInstanceId,e.appConfig,e.contactScope);this.state.appInstanceId=e.appInstanceId,this.state.appConfig=e.appConfig,this.state.contactScope=e.contactScope;const n={context:t};switch(e.stage){case"create":return this.handleCreate(n);case"start":return this.handleStart(n);case"stop":return this.handleStop(n);case"destroy":return this.handleDestroy(n)}}onStart(e,t){this.startHandlers.add(e),(null==t?void 0:t.invokeIfRunning)&&this.state.isRunning&&this.handleLifecycleChange(Object.assign(Object.assign({},this.getLifecycleChangeParams()),{stage:"start"}),(t=>e(t)),!1)}onStop(e){this.stopHandlers.add(e)}offStart(e){this.startHandlers.delete(e)}offStop(e){this.stopHandlers.delete(e)}get appState(){return Object.assign({},this.state)}handleCreate(e){return r(this,void 0,void 0,(function*(){var t;if(this.isDestroyed)return void this.logger.error("An attempt was Create after a Destroy. No Action",{appInstanceId:e.context.appInstanceId});if(this.isCreated)return void this.logger.error("An attempt was invoke Create after it was already invoked. No Action",{appInstanceId:e.context.appInstanceId});if(this.logger.debug("Begin Lifecycle Create",{appInstanceId:e.context.appInstanceId}),!(null===(t=this.provider.config)||void 0===t?void 0:t.onCreate)){const t="App did not specify an onCreated handler. This is required. Closing app",n={appInstanceId:e.context.appInstanceId};return this.logger.error(t,{appInstanceId:e.context.appInstanceId}),void this.provider.sendFatalError(t,n)}const{success:n}=yield this.handleLifecycleChange(Object.assign(Object.assign({},e),{stage:"create"}),(e=>this.provider.config.onCreate(e)),!0);n&&(this.isCreated=!0,this.sendLifecycleHandlerCompletedMessage(e.context.appInstanceId,"create"))}))}handleStart(e){return r(this,void 0,void 0,(function*(){if(this.isDestroyed)return void this.logger.error("An attempt was Start after a Destroy. No Action",{appInstanceId:e.context.appInstanceId});if(!this.isCreated)return void this.logger.error("An attempt was invoke Start before Create. No Action",{appInstanceId:e.context.appInstanceId});this.state.isRunning=!0,this.logger.info("Begin Lifecycle Start");const t=yield Promise.all([...this.startHandlers].map((t=>this.handleLifecycleChange(Object.assign(Object.assign({},e),{stage:"start"}),(e=>t(e)),!1))));this.logger.debug("Completed all start handlers",{count:this.startHandlers.size,errorCount:t.filter((({success:e})=>!e)).length})}))}handleStop(e){return r(this,void 0,void 0,(function*(){if(this.isDestroyed)return void this.logger.error("An attempt was Stop after a Destroy. No Action",{appInstanceId:e.context.appInstanceId});if(!this.isCreated)return void this.logger.error("An attempt was invoke Stop before Create. No Action",{appInstanceId:e.context.appInstanceId});this.state.isRunning=!1,this.logger.info("Begin Lifecycle Stop");const t=yield Promise.all([...this.stopHandlers].map((t=>this.handleLifecycleChange(Object.assign(Object.assign({},e),{stage:"stop"}),(e=>t(e)),!1))));this.logger.debug("Completed all stop handlers",{count:this.stopHandlers.size,errorCount:t.filter((({success:e})=>!e)).length})}))}handleDestroy(e){return r(this,void 0,void 0,(function*(){if(this.isDestroyed)return void this.logger.error("An attempt was invoke Destroy multiple times. No Action",{appInstanceId:e.context.appInstanceId});if(!this.isCreated)return void this.logger.error("An attempt was invoke Destroy before Create. No Action",{appInstanceId:e.context.appInstanceId});this.isDestroyed=!0,this.state.isRunning=!1,this.logger.info("Begin Lifecycle Destroy");const{config:t}=this.provider,{success:n}=yield this.handleLifecycleChange(Object.assign(Object.assign({},e),{stage:"destroy"}),(e=>t.onDestroy?t.onDestroy(e):Promise.resolve()),!0);n&&this.sendLifecycleHandlerCompletedMessage(e.context.appInstanceId,"destroy")}))}handleLifecycleChange(e,t,n){return r(this,void 0,void 0,(function*(){let r=!1;try{yield t(e),r=!0}catch(t){const{appInstanceId:r}=e.context;if(n){const n=`An fatal error occurred when handling a ${e.stage} lifecycle action. Closing app`;this.logger.error(n,{appInstanceId:r,error:t}),this.provider.sendFatalError(n,t)}else this.logger.error(`An error occurred when handling a ${e.stage} lifecycle action.`,{appInstanceId:r,error:t})}return{success:r}}))}getLifecycleChangeParams(){return{context:new s.AppContext(this.provider,this.state.appInstanceId,this.state.appConfig,this.state.contactScope)}}sendLifecycleHandlerCompletedMessage(e,t){this.logger.debug(`Sending lifecycle ${t} completed signal`),this.provider.getProxy().sendLifecycleHandlerCompleted(e,t)}}},8865:(e,t)=>{var n,r;Object.defineProperty(t,"__esModule",{value:!0}),t.ContactRoutes=t.AgentRoutes=void 0,function(e){e.getARN="agent/getARN",e.getName="agent/getName",e.getState="agent/getState",e.getRoutingProfile="agent/getRoutingProfile",e.getChannelConcurrency="agent/getChannelConcurrency",e.getExtension="agent/getExtension",e.getDialableCountries="agent/getDialableCountries",e.setAvailabilityState="agent/setAvailabilityState",e.setAvailabilityStateByName="agent/setAvailabilityStateByName",e.setOffline="agent/setOffline",e.listAvailabilityStates="agent/listAvailabilityStates",e.listQuickConnects="agent/listQuickConnects"}(n||(t.AgentRoutes=n={})),function(e){e.getAttributes="contact/getAttributes",e.getInitialContactId="contact/getInitialContactId",e.getType="contact/getType",e.getStateDuration="contact/getStateDuration",e.getQueue="contact/getQueue",e.getQueueTimestamp="contact/getQueueTimestamp",e.getDescription="contact/getDescription",e.getReferences="contact/getReferences",e.getChannelType="contact/getChannelType",e.addParticipant="contact/addParticipant",e.transfer="contact/transfer",e.accept="contact/accept",e.clear="contact/clear"}(r||(t.ContactRoutes=r={}))},9144:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},9463:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AppProxy=void 0;var r=n(2813);Object.defineProperty(t,"AppProxy",{enumerable:!0,get:function(){return r.AppProxy}})}}]);